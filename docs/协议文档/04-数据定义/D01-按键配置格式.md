# D01-按键配置格式

> 适用模块: M01-基础设置配置
> 数据位置: Byte 28~59

---

## 1. 概述

按键配置使用4字节格式，用于定义每个按键的功能映射。支持9种按键类型。

---

## 2. 4字节格式定义

| Byte1 | 类型名称   | Byte2      | Byte3       | Byte4    |
| ----- | ---------- | ---------- | ----------- | -------- |
| 0x00  | 键盘单键   | 0x00       | Key code    | 0x00     |
| 0x01  | 键盘组合键 | Modify key | Key code    | 2nd code |
| 0x02  | 鼠标按键   | 0x00       | Button ID   | 0x00     |
| 0x03  | 多媒体键   | 0x00       | 键值高位    | 键值低位 |
| 0x04  | 禁用按键   | 0x00       | 0x00        | 0x00     |
| 0x05  | DPI按键    | 0x00        | DPI change  | 0x00     |
| 0x06  | 功能按键   | Function ID | 扩展功能1   | 扩展功能2|
| 0x07  | 宏定义     | 0x00        | Macro ID    | 0x00     |
| 0x08  | 滚轮       | 0x00       | 方向        | 连续滚动 |

---

## 3. 各类型详解

### 3.1 键盘单键 (0x00)

将按键映射为单个键盘按键。

| 字节  | 值       | 说明         |
| ----- | -------- | ------------ |
| Byte1 | 0x00     | 类型标识     |
| Byte2 | 0x00     | 固定         |
| Byte3 | Key code | HID Usage ID |
| Byte4 | 0x00     | 固定         |

**示例 - 映射为A键:**

```
00 00 04 00
```

**示例 - 映射为Shift键:**

```
00 00 E1 00
```

### 3.2 键盘组合键 (0x01)

将按键映射为组合键（如Ctrl+C）。

| 字节  | 值         | 说明             |
| ----- | ---------- | ---------------- |
| Byte1 | 0x01       | 类型标识         |
| Byte2 | Modify key | 修饰键位图       |
| Byte3 | Key code   | 主键码           |
| Byte4 | 2nd code   | 第二键码（可选） |

**Modify key 位图:**

| Bit  | 修饰键  |
| ---- | ------- |
| bit0 | L-Ctrl  |
| bit1 | L-Shift |
| bit2 | L-Alt   |
| bit3 | L-Win   |
| bit4 | R-Ctrl  |
| bit5 | R-Shift |
| bit6 | R-Alt   |
| bit7 | R-Win   |

**示例 - Ctrl+Alt+Del:**

```
01 06 63 00
```

- `05` = bit0(L-Ctrl) + bit2(L-Alt) = 0x01 + 0x04
- `63` = Delete键

**示例 - Ctrl+C:**

```
01 01 06 00
```

- `01` = L-Ctrl
- `06` = C键

### 3.3 鼠标按键 (0x02)

将按键映射为鼠标按键。

| 字节  | 值        | 说明     |
| ----- | --------- | -------- |
| Byte1 | 0x02      | 类型标识 |
| Byte2 | 0x00      | 固定     |
| Byte3 | Button ID | 按键位图 |
| Byte4 | 0x00      | 固定     |

**Button ID 位图:**

| Bit  | 按键       | 值   |
| ---- | ---------- | ---- |
| bit0 | 左键       | 0x01 |
| bit1 | 右键       | 0x02 |
| bit2 | 中键       | 0x04 |
| bit3 | 前进键(B4) | 0x08 |
| bit4 | 后退键(B5) | 0x10 |

**示例 - 中键:**

```
02 00 04 00
```

**示例 - 前进键:**

```
02 00 08 00
```

### 3.4 多媒体键 (0x03)

将按键映射为多媒体功能键。

| 字节  | 值       | 说明               |
| ----- | -------- | ------------------ |
| Byte1 | 0x03     | 类型标识           |
| Byte2 | 0x00     | 固定               |
| Byte3 | 键值高位 | HID Usage ID高字节 |
| Byte4 | 键值低位 | HID Usage ID低字节 |

**常用多媒体键:**

| 功能       | Usage ID | Byte3 | Byte4 |
| ---------- | -------- | ----- | ----- |
| 音量加     | 0x00E9   | 0x00  | 0xE9  |
| 音量减     | 0x00EA   | 0x00  | 0xEA  |
| 静音       | 0x00E2   | 0x00  | 0xE2  |
| 播放/暂停  | 0x00CD   | 0x00  | 0xCD  |
| 下一曲     | 0x00B5   | 0x00  | 0xB5  |
| 上一曲     | 0x00B6   | 0x00  | 0xB6  |
| 停止       | 0x00B7   | 0x00  | 0xB7  |
| 计算器     | 0x0192   | 0x01  | 0x92  |
| 我的电脑   | 0x0194   | 0x01  | 0x94  |
| 浏览器主页 | 0x0223   | 0x02  | 0x23  |

**示例 - 音量加:**

```
03 00 00 E9
```

### 3.5 禁用按键 (0x04)

禁用该按键，按下无任何响应。

| 字节  | 值   | 说明     |
| ----- | ---- | -------- |
| Byte1 | 0x04 | 类型标识 |
| Byte2 | 0x00 | 固定     |
| Byte3 | 0x00 | 固定     |
| Byte4 | 0x00 | 固定     |

**示例:**

```
04 00 00 00
```

### 3.6 DPI按键 (0x05)

将按键映射为DPI切换功能。

| 字节  | 值         | 说明     |
| ----- | ---------- | -------- |
| Byte1 | 0x05       | 类型标识 |
| Byte2 | 0x00       | 固定     |
| Byte3 | DPI change | 切换模式 |
| Byte4 | 0x00       | 固定     |

**DPI change 值:**

| 值   | 功能                           |
| ---- | ------------------------------ |
| 0x00 | DPI+ (不循环，到最高档停止)    |
| 0x01 | DPI- (不循环，到最低档停止)    |
| 0x02 | DPI+ 循环 (到最高档回到最低档) |
| 0x03 | DPI- 循环 (到最低档回到最高档) |

**示例 - DPI循环加:**

```
05 00 02 00
```

### 3.7 功能按键 (0x06)

将按键映射为特殊功能，如板载配置切换。

| 字节  | 值          | 说明                 |
| ----- | ----------- | -------------------- |
| Byte1 | 0x06        | 类型标识             |
| Byte2 | Function ID | 功能类型             |
| Byte3 | 扩展功能1   | 根据功能类型不同     |
| Byte4 | 扩展功能2   | 根据功能类型不同     |

**Function ID 定义:**

| 值   | 功能             | Byte3说明                                    | Byte4 |
| ---- | ---------------- | -------------------------------------------- | ----- |
| 0x03 | 板载配置切换     | 0xFF=自动循环切换，0x00~0x04=切换到指定配置  | 0x00  |

**示例 - 板载配置循环切换:**

```
06 03 FF 00
```

**示例 - 切换到板载配置2:**

```
06 03 02 00
```

**注意:** 按下功能按键后，设备会通过0xB2命令通知PC端参数变更，详见 [M08-设备参数变更通知](../03-系统模块/M08-设备参数变更通知.md)。

### 3.8 宏定义 (0x07)

将按键绑定到宏。

| 字节  | 值       | 说明             |
| ----- | -------- | ---------------- |
| Byte1 | 0x07     | 类型标识         |
| Byte2 | 0x00     | 固定             |
| Byte3 | Macro ID | 宏存储区ID (0~9) |
| Byte4 | 0x00     | 固定             |

**示例 - 绑定宏3:**

```
07 00 02 00
```

- `02` = 宏ID 2（第3个宏）

**注意:** 绑定宏前需要先通过M03配置宏数据。

### 3.9 滚轮 (0x08)

将按键映射为滚轮功能。

| 字节  | 值       | 说明     |
| ----- | -------- | -------- |
| Byte1 | 0x08     | 类型标识 |
| Byte2 | 0x00     | 固定     |
| Byte3 | 方向     | 滚动方向 |
| Byte4 | 连续滚动 | 暂不开放 |

**方向值:**

| 值   | 方向         |
| ---- | ------------ |
| 0x00 | 前滚（向上） |
| 0x01 | 后滚（向下） |
| 0x02 | 左滚         |
| 0x03 | 右滚         |

**示例 - 滚轮后滚:**

```
08 00 01 00
```

---

## 4. 默认按键配置

| 按键     | 字节位置 | 默认值      | 说明                     |
| -------- | -------- | ----------- | ------------------------ |
| 左键     | 28~31    | 02 00 01 00 | 鼠标左键（暂不开放修改） |
| 中键     | 32~35    | 02 00 04 00 | 鼠标中键                 |
| 右键     | 36~39    | 02 00 02 00 | 鼠标右键                 |
| 前进键   | 40~43    | 02 00 10 00 | 鼠标前进键               |
| 后退键   | 44~47    | 02 00 08 00 | 鼠标后退键               |
| 滚轮前滚 | 48~51    | 08 00 00 00 | 滚轮向上                 |
| 滚轮后滚 | 52~55    | 08 00 01 00 | 滚轮向下                 |
| DPI键    | 56~59    | 05 00 02 00 | DPI循环加                |

---

## 5. 代码示例

```javascript
// 按键配置编码
function encodeButtonConfig(type, param1, param2, param3) {
  return new Uint8Array([type, param1, param2, param3])
}

// 键盘单键
const keyA = encodeButtonConfig(0x00, 0x00, 0x04, 0x00)

// 组合键 Ctrl+C
const ctrlC = encodeButtonConfig(0x01, 0x02, 0x06, 0x00)

// 鼠标中键
const middleBtn = encodeButtonConfig(0x02, 0x00, 0x04, 0x00)

// 多媒体键 - 音量加
const volumeUp = encodeButtonConfig(0x03, 0x00, 0x00, 0xe9)

// 禁用按键
const disabled = encodeButtonConfig(0x04, 0x00, 0x00, 0x00)

// DPI循环加
const dpiCycle = encodeButtonConfig(0x05, 0x00, 0x02, 0x00)

// 绑定宏ID 0
const macro0 = encodeButtonConfig(0x07, 0x00, 0x00, 0x00)

// 滚轮后滚
const wheelDown = encodeButtonConfig(0x08, 0x00, 0x01, 0x00)
```

---

## 6. 相关文档

- [M01-基础设置配置](../01-核心模块/M01-基础设置配置.md)
- [A01-键码表](../05-附录/A01-键码表.md)
- [M03-宏配置](../02-功能模块/M03-宏配置.md)
- [M08-设备参数变更通知](../03-系统模块/M08-设备参数变更通知.md)

---

## 7. 变更记录

| 版本 | 日期       | 修改内容                                     |
| ---- | ---------- | -------------------------------------------- |
| 1.0  | 2026-01-05 | 初版，基于协议V1.0.5                         |
| 1.1  | 2026-01-16 | 基于V1.0.7更新：功能按键(0x06)板载配置切换   |
