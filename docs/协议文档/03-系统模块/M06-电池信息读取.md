# M06-电池信息读取

> 命令码: 0xA6
> 状态: 可用
> 优先级: P1 (无线设备必需)

---

## 1. 功能描述

### 1.1 模块职责

获取无线鼠标的电池状态信息，包括充电状态、电压值和电量百分比。

### 1.2 使用场景

- 无线鼠标连接时显示电量
- 定时轮询电池状态
- 充电状态变化时更新UI

### 1.3 前置条件

- 设备已连接并识别
- 适用于无线鼠标

---

## 2. 协议指令格式说明

### 2.1 请求格式 (PC → 设备)

| Byte | 字段     | 值/范围   | 说明         |
| ---- | -------- | --------- | ------------ |
| 0    | 包头     | 0xBA      | 固定值       |
| 1    | 连接模式 | 0x8A/0xFF | 无线/有线    |
| 2    | 命令码   | 0xA6      | 读取电池信息 |
| 3    | 数据长度 | 0x00      | 无数据       |
| 4~63 | padding  | 0x00      | 补0          |

### 2.2 响应格式 (设备 → PC)

**正常响应 (ACK):**

| Byte | 字段       | 值/范围   | 说明                 |
| ---- | ---------- | --------- | -------------------- |
| 0    | 包头       | 0x5A      | 正常响应             |
| 1    | 连接模式   | 0x8A/0xFF | 无线/有线            |
| 2    | 命令码     | 0xA6      | 读取电池信息         |
| 3    | 数据长度   | 0x04      | 4字节                |
| 4    | status     | 0x00~0x03 | 电池状态             |
| 5~6  | voltage    | uint16    | 电压值（低字节在前） |
| 7    | percentage | 0~100     | 电量百分比           |
| 8~63 | padding    | 0x00      | 补0                  |

---

## 3. 请求示例

### 3.1 示例: 读取电池信息

**请求数据 (Hex):**

```
BA FF A6 00 00 00 00 00 ... (补0至64字节)
```

---

## 4. 响应示例

### 4.1 正常响应示例 - 充电中

**响应数据 (Hex):**

```
5A FF A6 04 01 85 0C 4B 00 00 ... (补0)
```

**字段解析:**

- `01`: 电池状态 - 充电中
- `85 0C`: 电压值 0x0C85 = 3205 = 3.205V
- `4B`: 电量百分比 0x4B = 75%

### 4.2 正常响应示例 - 空闲状态

**响应数据 (Hex):**

```
5A FF A6 04 00 20 0F 64 00 00 ... (补0)
```

**字段解析:**

- `00`: 电池状态 - 空闲
- `20 0F`: 电压值 0x0F20 = 3872 = 3.872V
- `64`: 电量百分比 0x64 = 100%

---

## 5. 字段解析

### 5.1 电池状态 (status)

| 值   | 含义   | UI显示建议      |
| ---- | ------ | --------------- |
| 0x00 | 空闲   | 显示电量图标    |
| 0x01 | 充电中 | 显示充电动画    |
| 0x02 | 充满电 | 显示满电图标    |
| 0x03 | 未稳定 | 不显示/忽略数据 |

### 5.2 电压值 (voltage)

```javascript
// 解析电压值
const voltage = (data[6] << 8) | data[5]
const voltageV = voltage / 1000 // 转换为V
console.log(`${voltageV}V`) // 如 3.205V
```

### 5.3 电量百分比 (percentage)

- 范围: 0 ~ 100
- 单位: %
- 最大值: 0x64 (100%)

---

## 6. 约束与注意事项

### 6.1 使用建议

- 建议轮询间隔: 30秒~1分钟
- 状态为0x03时应忽略数据
- 有线鼠标可能返回固定值或不支持

### 6.2 特殊处理

- 充电状态变化时可能需要刷新UI
- 低电量时建议提示用户

---

## 7. 调试建议

### 7.1 日志输出建议

```javascript
const statusMap = ['空闲', '充电中', '充满电', '未稳定']
console.log('[M06] 电池信息:', {
  status: statusMap[data[4]],
  voltage: `${voltage / 1000}V`,
  percentage: `${data[7]}%`
})
```

---

## 8. 常见错误

| 错误现象    | 可能原因       | 解决方案     |
| ----------- | -------------- | ------------ |
| 电量始终为0 | 有线鼠标不支持 | 检查设备类型 |
| 状态为0x03  | 电池数据未稳定 | 等待后重试   |

---

## 9. 相关模块

- [M05-设备信息获取](M05-设备信息获取.md) - 确认设备类型

---

## 10. 变更记录

| 版本 | 日期       | 修改内容             |
| ---- | ---------- | -------------------- |
| 1.0  | 2026-01-05 | 初版，基于协议V1.0.5 |
