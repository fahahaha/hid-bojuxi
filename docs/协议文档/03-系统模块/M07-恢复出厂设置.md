# M07-恢复出厂设置

> 命令码: 0xA7
> 状态: 可用
> 优先级: P2 (系统维护)

---

## 1. 功能描述

### 1.1 模块职责

将设备的所有基础设置恢复为出厂默认值，并清空宏录制存储区。

### 1.2 使用场景

- 用户主动恢复出厂设置
- 设备配置异常时重置
- 清除所有自定义配置

### 1.3 前置条件

- 设备已连接并识别
- 建议弹窗让用户二次确认

---

## 2. 协议指令格式说明

### 2.1 请求格式 (PC → 设备)

| Byte | 字段     | 值/范围   | 说明         |
| ---- | -------- | --------- | ------------ |
| 0    | 包头     | 0xBA      | 固定值       |
| 1    | 连接模式 | 0x8A/0xFF | 无线/有线    |
| 2    | 命令码   | 0xA7      | 恢复出厂设置 |
| 3    | 数据长度 | 0x00      | 无数据       |
| 4~63 | padding  | 0x00      | 补0          |

### 2.2 响应格式 (设备 → PC)

**正常响应 (ACK):**

| Byte | 字段     | 值/范围   | 说明           |
| ---- | -------- | --------- | -------------- |
| 0    | 包头     | 0x5A      | 正常响应       |
| 1    | 连接模式 | 0x8A/0xFF | 无线/有线      |
| 2    | 命令码   | 0xA7      | 恢复出厂设置   |
| 3    | 数据长度 | 0x01      | 1字节          |
| 4    | status   | 0x00      | 执行完毕状态码 |
| 5~63 | padding  | 0x00      | 补0            |

---

## 3. 请求示例

### 3.1 示例: 恢复出厂设置

**请求数据 (Hex):**

```
BA FF A7 00 00 00 00 00 ... (补0至64字节)
```

---

## 4. 响应示例

### 4.1 正常响应示例

**响应数据 (Hex):**

```
5A FF A7 01 00 00 00 00 ... (补0)
```

**字段解析:**

- `5A`: 正常响应包头
- `A7`: 恢复出厂设置命令
- `01`: 数据长度1字节
- `00`: 状态码 - 执行成功

---

## 5. 字段解析

### 5.1 状态码 (status)

| 值   | 含义                       |
| ---- | -------------------------- |
| 0x00 | 执行成功                   |
| 其他 | 执行失败（参考错误码定义） |

---

## 6. 约束与注意事项

### 6.1 使用建议

- **必须弹窗二次确认**，避免误操作
- 执行后需要重新读取配置同步UI
- 所有宏数据将被清空

### 6.2 恢复内容

- 回报率恢复为1000Hz
- DPI恢复为默认档位和数值
- 按键映射恢复为默认
- 滚轮方向恢复为正向
- 所有宏数据清空

### 6.3 执行时间

- 可能需要较长时间（Flash擦除）
- 建议设置较长的超时时间

---

## 7. 调试建议

### 7.1 调试步骤

1. 发送恢复出厂命令
2. 等待ACK响应
3. 调用M02读取配置验证
4. 更新UI显示

### 7.2 日志输出建议

```javascript
console.log('[M07] 发送恢复出厂设置请求')
console.log('[M07] 响应状态:', data[4] === 0 ? '成功' : '失败')
```

---

## 8. 常见错误

| 错误现象            | 可能原因         | 解决方案       |
| ------------------- | ---------------- | -------------- |
| 返回0x05/0x06错误码 | Flash操作失败    | 重试或检查设备 |
| 超时无响应          | 设备正在执行擦除 | 增加超时时间   |

---

## 9. 相关模块

- [M02-基础设置读取](../01-核心模块/M02-基础设置读取.md) - 恢复后重新读取配置

---

## 10. 变更记录

| 版本 | 日期       | 修改内容             |
| ---- | ---------- | -------------------- |
| 1.0  | 2026-01-05 | 初版，基于协议V1.0.5 |
